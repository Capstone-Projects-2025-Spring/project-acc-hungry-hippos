"use strict";(self.webpackChunkcreate_project_docs=self.webpackChunkcreate_project_docs||[]).push([[5571],{23445:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>a,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var i=n(74848),d=n(28453);const r={sidebar_position:2,description:"Backend API"},t="Backend API",c={id:"api-specification/Backend",title:"Backend API",description:"Backend API",source:"@site/docs/api-specification/Backend.md",sourceDirName:"api-specification",slug:"/api-specification/Backend",permalink:"/project-acc-hungry-hippos/docs/api-specification/Backend",draft:!1,unlisted:!1,editUrl:"https://github.com/Capstone-Projects-2025-Spring/project-acc-hungry-hippos/edit/main/documentation/docs/api-specification/Backend.md",tags:[],version:"current",lastUpdatedBy:"Kostandin Jorgji",sidebarPosition:2,frontMatter:{sidebar_position:2,description:"Backend API"},sidebar:"docsSidebar",previous:{title:"Frontend API",permalink:"/project-acc-hungry-hippos/docs/api-specification/Frontend"},next:{title:"Test Procedures",permalink:"/project-acc-hungry-hippos/docs/category/test-procedures"}},l={},o=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Overview",id:"overview",level:2},{value:"Utility Functions",id:"utility-functions",level:2},{value:"<code>generateSessionId(length = 5)</code>",id:"generatesessionidlength--5",level:3},{value:"<code>generateUniqueSessionId(existingSessions, length = 5)</code>",id:"generateuniquesessionidexistingsessions-length--5",level:3},{value:"<code>broadcast(sessionId, data)</code>",id:"broadcastsessionid-data",level:3},{value:"<code>getWeightedRandomFood(allFoods, targetId)</code>",id:"getweightedrandomfoodallfoods-targetid",level:3},{value:"WebSocket Communication",id:"websocket-communication",level:2},{value:"Client-to-Server Messages",id:"client-to-server-messages",level:3},{value:"Server-to-Client Broadcasts",id:"server-to-client-broadcasts",level:3},{value:"Server Info",id:"server-info",level:2}];function h(e){const s={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"backend-api",children:"Backend API"}),"\n",(0,i.jsx)(s.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#overview",children:"Overview"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#utility-functions",children:"Utility Functions"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#generatesessionid",children:"generateSessionId"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#generateuniquesessionid",children:"generateUniqueSessionId"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"#websocket-communication",children:"WebSocket Communication"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#client-to-server-messages",children:"Client-to-Server Messages"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#server-to-client-broadcasts",children:"Server-to-Client Broadcasts"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#server-info",children:"Server Info"})}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["The backend is a ",(0,i.jsx)(s.strong,{children:"central, real-time game server"})," built with ",(0,i.jsx)(s.strong,{children:"Node.js"})," and the ",(0,i.jsx)(s.code,{children:"ws"})," WebSocket library. It manages the entire lifecycle of a game session."]}),"\n",(0,i.jsxs)(s.p,{children:["Instead of traditional REST endpoints, the server communicates with clients ",(0,i.jsx)(s.strong,{children:"exclusively through WebSocket messages"}),". It maintains the game state for each session \u2014 including player positions, scores, and the state of all active food items \u2014 and runs a central ",(0,i.jsx)(s.code,{children:"setInterval"})," game loop to handle physics and spawning."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Production"}),": Uses ",(0,i.jsx)(s.strong,{children:"PostgreSQL (via Railway)"})," to persist session/player data."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Local Development"}),": Uses a JSON file for session storage."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"utility-functions",children:"Utility Functions"}),"\n",(0,i.jsx)(s.h3,{id:"generatesessionidlength--5",children:(0,i.jsx)(s.code,{children:"generateSessionId(length = 5)"})}),"\n",(0,i.jsx)(s.p,{children:"Generates a random alphanumeric session ID consisting of uppercase letters and digits."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameters"}),":",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"length"})," \u2014 ",(0,i.jsx)(s.code,{children:"number"}),", defaults to ",(0,i.jsx)(s.code,{children:"5"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Returns"}),":",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"string"})," \u2014 A randomly generated session ID"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"generateuniquesessionidexistingsessions-length--5",children:(0,i.jsx)(s.code,{children:"generateUniqueSessionId(existingSessions, length = 5)"})}),"\n",(0,i.jsx)(s.p,{children:"Generates a unique session ID that does not exist in the provided list."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameters"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"existingSessions"})," \u2014 ",(0,i.jsx)(s.code,{children:"string[]"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"length"})," \u2014 ",(0,i.jsx)(s.code,{children:"number"}),", defaults to ",(0,i.jsx)(s.code,{children:"5"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Returns"}),":",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"string"})," \u2014 A new unique session ID"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"broadcastsessionid-data",children:(0,i.jsx)(s.code,{children:"broadcast(sessionId, data)"})}),"\n",(0,i.jsx)(s.p,{children:"Broadcasts a message to all WebSocket clients connected to a given session."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameters"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"sessionId"})," \u2014 ",(0,i.jsx)(s.code,{children:"string"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"data"})," \u2014 ",(0,i.jsx)(s.code,{children:"object"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Effect"}),":",(0,i.jsx)(s.br,{}),"\n","Sends a JSON message to all connected clients in the session."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"getweightedrandomfoodallfoods-targetid",children:(0,i.jsx)(s.code,{children:"getWeightedRandomFood(allFoods, targetId)"})}),"\n",(0,i.jsx)(s.p,{children:"Returns a randomly selected food object with higher probability for the target food."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parameters"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"allFoods"})," \u2014 ",(0,i.jsx)(s.code,{children:"object[]"})," \u2014 List of all possible food items"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"targetId"})," \u2014 ",(0,i.jsx)(s.code,{children:"string"})," \u2014 ID of the food to favor"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Returns"}),":",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.code,{children:"object"})," \u2014 A food item selected with weighted probability"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"websocket-communication",children:"WebSocket Communication"}),"\n",(0,i.jsxs)(s.p,{children:["The server operates by receiving messages from clients and broadcasting ",(0,i.jsx)(s.strong,{children:"state updates"})," to all clients in a given session."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"client-to-server-messages",children:"Client-to-Server Messages"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Message Type"}),(0,i.jsx)(s.th,{children:"Payload"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"CREATE_SESSION"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{}"})}),(0,i.jsx)(s.td,{children:"Requests the server to generate a new unique session ID."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"VALIDATE_SESSION"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ gameCode: string }"})}),(0,i.jsx)(s.td,{children:"Asks the server if a given session code is valid."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"PLAYER_JOIN"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, userId, role, color }"})}),(0,i.jsx)(s.td,{children:"Informs the server that a new player has joined a session."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"PLAYER_MOVE"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, userId, x, y }"})}),(0,i.jsx)(s.td,{children:"Sends the local player's position to the server."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"AAC_FOOD_SELECTED"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, food, effect }"})}),(0,i.jsx)(s.td,{children:"AAC user selects a target food with optional effect."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"FRUIT_EATEN_BY_PLAYER"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, userId, isCorrect, effect }"})}),(0,i.jsx)(s.td,{children:"Player collided with a fruit."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"PLAYER_EFFECT_APPLIED"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, targetUserId, effect }"})}),(0,i.jsx)(s.td,{children:"A visual effect was applied to a player."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"SET_EDGE"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, userId, edge }"})}),(0,i.jsx)(s.td,{children:"Assigns a player to a screen edge."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"START_GAME"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId, mode }"})}),(0,i.jsx)(s.td,{children:"Host starts the game for all players."})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h3,{id:"server-to-client-broadcasts",children:"Server-to-Client Broadcasts"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Message Type"}),(0,i.jsx)(s.th,{children:"Payload"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"SESSION_CREATED"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ sessionId: string }"})}),(0,i.jsxs)(s.td,{children:["Responds to ",(0,i.jsx)(s.code,{children:"CREATE_SESSION"})," with new session ID."]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"USERS_LIST_UPDATE"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ users: [...] }"})}),(0,i.jsx)(s.td,{children:"Broadcasts updated list of all players in session."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"FOOD_STATE_UPDATE"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ foods: [...] }"})}),(0,i.jsx)(s.td,{children:"Core game sync message \u2014 full state of active food."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"AAC_TARGET_FOOD"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ targetFoodId, targetFoodData, effect }"})}),(0,i.jsx)(s.td,{children:"Sets the correct food to target."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"PLAYER_EFFECT_BROADCAST"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ targetUserId, effect }"})}),(0,i.jsx)(s.td,{children:"Apply visual effect (e.g. freeze, grow) to player."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"SCORE_UPDATE_BROADCAST"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{ scores: {...} }"})}),(0,i.jsx)(s.td,{children:"Sends updated scores to all players."})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"GAME_OVER"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"{}"})}),(0,i.jsx)(s.td,{children:"Notifies all clients that the game has ended."})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"server-info",children:"Server Info"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Port"}),": ",(0,i.jsx)(s.code,{children:"4000"})," (local dev)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Protocol"}),": ",(0,i.jsx)(s.code,{children:"ws://"})," (WebSocket)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Storage"}),":","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Local: ",(0,i.jsx)(s.code,{children:"./src/data/sessionID.json"})]}),"\n",(0,i.jsxs)(s.li,{children:["Production: ",(0,i.jsx)(s.strong,{children:"PostgreSQL on Railway"})]}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>c});var i=n(96540);const d={},r=i.createContext(d);function t(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);